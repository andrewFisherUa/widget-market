!function e(t,i,r){function o(s,a){if(!i[s]){if(!t[s]){var d="function"==typeof require&&require;if(!a&&d)return d(s,!0);if(n)return n(s,!0);throw new Error("Cannot find module '"+s+"'")}var c=i[s]={exports:{}};t[s][0].call(c.exports,function(e){var i=t[s][1][e];return o(i||e)},c,c.exports,e,t,i,r)}return i[s].exports}for(var n="function"==typeof require&&require,s=0;s<r.length;s++)o(r[s]);return o}({1:[function(require,module,exports){"use strict";function symmetricDifference(e,t){for(var i=[],r=0;r<e.length;r++)-1===t.indexOf(e[r])&&i.push(e[r]);for(r=0;r<t.length;r++)-1===e.indexOf(t[r])&&i.push(t[r]);return i}var yaWidgetLib=require("./yaWidget"),BridgeLib=require("./iFrameBridge"),Bridge=BridgeLib.Bridge,CallAction=BridgeLib.callAction,ajax=require("./httpclient").ajax,WidgetEditor=function(container,src){this.container=container.get(0),this.typeResourse=1,this.container.dataset.hasOwnProperty("idtype")&&(this.typeResourse=this.container.dataset.idtype),this.id=this.container.dataset.id,3==this.typeResourse?"mobile_area"==this.container.id?this.src=src||"//widget.market-place.su/widget_tizer/mobile_render":this.src=src||"//widget.market-place.su/widget_tizer/render":"mobile_area"==this.container.id?this.src=src||"//widget.market-place.su/widget/mobile_render":this.src=src||"//widget.market-place.su/widget/render",this.iFrame=null,this.currentTemplateName="",this.defCategories=[],this.defH1="",this.defDriver=0,this.summa_from=0,this.summa_to=0,this.currentTemplateRows={row:0,cols:0},this.params={width:"200px",height:"200px",categories:""},this.plugins={},this.Bridge=new Bridge,this.index=this.Bridge.index,console.log(["индекс",this.index]);var self=this;this.Bridge.addAction("resize",function(e){self.resize(e.size)}),this.Bridge.addAction("adExec",function(data){console.log(["exec приехал ",data]),data.func&&eval(data.func)}),this.on("ready",function(e){}),this.readyState=!0};WidgetEditor.prototype.on=function(e,t){void 0===this.events&&(this.events={}),void 0===this.events[e]&&(this.events[e]=[]),this.events[e].push(t)},WidgetEditor.prototype.checkReloadin=function(e){console.log(e);var t=0,i=[],r=0;if(e.hasOwnProperty("categories")&&(i=symmetricDifference(e.categories,this.defCategories),this.defCategories=e.categories),e.hasOwnProperty("h1")&&this.defH1!=e.h1&&(this.defH1=e.h1,r=1),e.hasOwnProperty("driver")&&this.defDriver!=e.driver&&(this.defDriver=e.driver,r=1),e.hasOwnProperty("summa_from")&&this.summa_from!=e.summa_from&&(this.summa_from=e.summa_from,t=1),e.hasOwnProperty("summa_to")&&this.summa_to!=e.summa_to&&(this.summa_to=e.summa_to,t=1),this.currentTemplateRows.cols!=e.cols||this.currentTemplateRows.row!=e.row||this.currentTemplateName!=e.name)return this.currentTemplateRows.cols=e.cols,this.currentTemplateRows.row=e.row,this.currentTemplateName=e.name,!0;if(t)return!0;if(i.length||r)return!0;if(this.currentTemplateRows.cols=e.cols,this.currentTemplateRows.row=e.row,this.currentTemplateName=e.name,e.hasOwnProperty("name")&&this.currentTemplateName==e.name){o={type:"style",style:"#widget {width: 50px !important;        max-width: 50px !important;}"};if("mobile_area"==this.container.id)o={exec:'\t var TempName="'+e.name+'";  \t var myStyles= document.styleSheets;\t var sheet=null;\t for(var i=0,j=myStyles.length;i<j;i++){\t sheet=myStyles[i];\t }\t if(sheet){\t var foot="'+e.mobile_background+'".split(",");\t foot[3]="1)";\t var foot_back=foot.join(",");\t sheet.cssRules[0].style.background="'+e.mobile_background+'";\t sheet.cssRules[0].style.fontFamily="'+e.mobile_font_family+'";\t sheet.cssRules[1].style.background="'+e.background_model+'";\t sheet.cssRules[2].style.background="'+e.background_model_hover+'";\t }    ',src:"",onload:""};else var o={exec:'\t var TempName="'+e.name+'";  \t var myStyles= document.styleSheets;\t var sheet=null;\t for(var i=0,j=myStyles.length;i<j;i++){\t sheet=myStyles[i];\t }\t if(sheet){\t var foot="'+e.background+'".split(",");\t foot[3]="1)";\t var foot_back=foot.join(",");\t console.log(foot_back);\t console.log(["плеер",sheet.cssRules[0]]); \t sheet.cssRules[0].style.maxWidth="'+e.width+'";\t sheet.cssRules[0].style.width="'+e.width+'";\t sheet.cssRules[0].style.height="'+e.height+'";\t sheet.cssRules[0].style.borderRadius="'+e.border_radius+'px";\t if (TempName=="module-block-yandex_left"){\t sheet.cssRules[0].style.background=foot_back;\t }\t else{\t sheet.cssRules[0].style.background="'+e.background+'";\t }\t sheet.cssRules[0].style.fontFamily="'+e.font_family+'";\t sheet.cssRules[1].style.background=foot_back;\t sheet.cssRules[2].style.borderColor="'+e.border_color+'";\t sheet.cssRules[2].style.borderWidth="'+e.border_width+'px";\t sheet.cssRules[2].style.borderRadius="'+e.border_radius+'px";\t sheet.cssRules[3].style.background="'+e.background_model+'";\t sheet.cssRules[4].style.background="'+e.background_model_hover+'";\t sheet.cssRules[5].style.background="'+e.background_model_hover+'";\t sheet.cssRules[6].style.fontSize="calc(14px * '+e.font_size+')";\t sheet.cssRules[7].style.fontSize="calc(16px * '+e.font_size+')";\t }    ',src:"",onload:""};return 2==this.defDriver?setTimeout(function(){this.appendInFrameJS(o)}.bind(this),4e3):this.appendInFrameJS(o),!1}return!0},WidgetEditor.prototype.reloadYandexAPI=function(e){e=e||{},console.log(["Шаримся в ф-ции reloadYandexAPI",e]);for(var t in e)console.log(["Шаримся в ф-ции reloadYandexAPI",t,e[t]]),e.hasOwnProperty(t)||(e[t]=e[t]);for(let t in e)alert(t);e.hasOwnProperty("type")?alert(e.type+" есть"):alert("pars пустой")},WidgetEditor.prototype.createIframe=function(e){if(e=e||{},this.checkReloadin(e)){for(var t in this.params)console.log(["пключ рел",t,e[t]]),e.hasOwnProperty(t)||(e[t]=this.params[t]);var i=this;this.getProducts(e,function(t){var r=JSON.parse(t);if(console.log(["дата !",r]),r.hasOwnProperty("hash")){if("myyandex"==r.hash){new yaWidgetLib(i.container,r.clid);return}i.iFrame=document.createElement("iframe"),i.iFrame.scrolling="yes",i.iFrame.style.border="0",i.iFrame.style.margin="0",i.iFrame.style.width="100%","mobile_area"==i.container.id?i.iFrame.style.height="310px":i.iFrame.style.height="600px";o="";if(r.hasOwnProperty("cnt"))var o="&cnt="+r.cnt;var n=i.src+"?data="+encodeURIComponent(JSON.stringify(e))+"&index="+i.index+"&hash="+r.hash+o;if(console.log(["утро 2",n]),i.iFrame.src=n,"mobile_area"==i.container.id){var s=document.getElementById("preview_mobile_cut_cut");s.appendChild(i.iFrame);var a=document.createElement("span");a.id="mobile_text",a.textContent='"Олигархи, вперед на подвиги !!!"',s.appendChild(a)}else i.container.appendChild(i.iFrame)}else console.log(["ненайду концов"])},function(e){})}},WidgetEditor.prototype.reloadIframe=function(e){if(!this.iFrame)return this.createIframe(e);if(this.checkReloadin(e)){var t=this;for(var i in this.params)console.log(["пключ",i,e[i]]),e.hasOwnProperty(i)||(e[i]=this.params[i]);this.getProducts(e,function(i){var r=JSON.parse(i);if(r.hasOwnProperty("hash")){o="";if(r.hasOwnProperty("cnt"))var o="&cnt="+r.cnt;console.log(["готов забугор",e]);var n=t.src+"?data="+encodeURIComponent(JSON.stringify(e))+"&index="+t.index+"&hash="+r.hash+o;if(console.log(["утро",n]),t.iFrame.src=n,"mobile_area"==t.container.id){var s=document.getElementById("preview_mobile_cut_cut");s.appendChild(t.iFrame);var a=document.createElement("span");a.id="mobile_text",a.textContent='" Есть ещё кто то кто лучше других"';var d=document.getElementById("mobile_text");d&&s.removeChild(d),s.appendChild(a)}else t.container.appendChild(t.iFrame)}else t.iFrame.src="",console.log(["ненайду концов 2"])},function(e){console.log(["ненайду концов 1"])})}},WidgetEditor.prototype.reDrowContainer=function(){if("mobile_area"==this.container.id){var e=document.getElementById("preview_mobile_cut_cut");if(e){var t=document.createElement("div");t.id=e.id,t.innerHTML="Олимпийские игры, которые пройдут в южнокорейском Пченчхане в феврале 2018 года.",e.parentNode.replaceChild(t,e)}}},WidgetEditor.prototype.getProducts=function(e,t,i){e=e||{};var r={},o={geo_id:"",url:window.location.href,text:{models:{},texts:{}},categories:"",count:3,nostat:1,driver:1,summa_from:0,summa_to:0};this.reDrowContainer();for(var n in o)e.hasOwnProperty(n)&&e[n]?r[n]=e[n]:r[n]=o[n];e.hasOwnProperty("h1")&&(r.userText=e.h1);var s="//request.market-place.su/dev?mth=api&id="+this.id+"&rnd="+Math.random()+"&data="+encodeURIComponent(JSON.stringify(r));t=t||function(){},i=i||function(){},ajax(s,{successFn:function(e){console.log(["непойду и не буду",e]),t(e)},errorFn:function(e){i(e)}})},WidgetEditor.prototype.resize=function(e){var t=e.width,i=parseInt(e.height)+55+"px";this.iFrame.style.width=t,this.iFrame.style.height=i},WidgetEditor.prototype.unloadPlugins=function(){},WidgetEditor.prototype.loadPlugins=function(e){for(var t=0,i=e.length;t<i;t++);},WidgetEditor.prototype.appendScript=function(e,t){t=t||function(){};var i=document.createElement("script");i.src=e,i.onload=function(){t()},document.body.appendChild(i)},WidgetEditor.prototype.appendInFrameCSS=function(e){var t={type:"style",style:".someclass{ color:red;}"};for(var i in t)e.hasOwnProperty(i)&&(t[i]=e[i]);this.sendToFrame("appendStyle",t),console.log("style")},WidgetEditor.prototype.appendInFrameJS=function(e){var t={exec:"",src:"",onload:""};for(var i in t)e.hasOwnProperty(i)&&(t[i]=e[i]);this.sendToFrame("appendScript",t)},WidgetEditor.prototype.sendToFrame=function(e,t,i){i=i||0,this.readyState&&(this.iFrame?(t.index=this.index,this.iFrame.contentWindow?(console.log(["по фрейму",e,t,this.iFrame.contentWindow]),CallAction(e,t,this.iFrame.contentWindow)):console.log(["нету фрейма или"])):console.log(["дата фрейма",t]))},module.exports=WidgetEditor},{"./httpclient":2,"./iFrameBridge":3,"./yaWidget":4}],2:[function(e,t,i){"use strict";var r={ajax:function(e,t){var i=e,r=(t=t||{}).errorFn||function(){},o=t.successFn||function(){},n=t.type||"GET",s=t.data||{},a=JSON.stringify(s);if(n=n.toUpperCase(),window.XMLHttpRequest)d=new XMLHttpRequest;else var d=new ActiveXObject("Microsoft.XMLHTTP");if("GET"==n){a=null,i.indexOf("?")<0&&(i+="?1=1");for(var c in s)s.hasOwnProperty(c)&&(i+="&"+c+"="+s[c])}d.open(n,i,!0),d.onreadystatechange=function(){4==d.readyState?200==d.status?o({response:d.responseText}):r({status:d.status}):r({status:d.readyState})},d.onreadystatechange=function(){4==d.readyState&&(console.log([17,d.status]),200==d.status?o(d.responseText):r({status:d.status}))};try{d.withCredentials=t.withCredentials||!1,d.send(a)}catch(e){}}};t.exports=r},{}],3:[function(e,t,i){"use strict";function r(e){var e=e||o();return void 0===window.MpFrameBridges&&(window.MpFrameBridges={}),void 0!==window.MpFrameBridges[e]?window.MpFrameBridges[e]:(window.MpFrameBridges[e]=new n(e),window.MpFrameBridges[e])}function o(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}function n(e){this.index=e||o();var t={default:function(){}};this.execAction=function(e,i){(t[e]||t.default||function(){}).call(this,i)},this.addAction=function(e,i){t[e]=i},this.showActions=function(){console.log(t)}}window.makeBridge=r,window.mp_bridge_listener=function(e){if("object"==typeof e.data&&void 0!==e.data.bridgeAction&&1==e.data.bridgeAction){if(console.log(["событие",e.data]),"broadcast"==e.data.data.index&&void 0!==window.MpFrameBridges)for(var t in window.MpFrameBridges)window.MpFrameBridges.hasOwnProperty(t)&&window.MpFrameBridges[t].execAction(e.data.name,e.data.data);r(e.data.data.index).execAction(e.data.name,e.data.data)}},void 0===window.MpBridgeListenerAttached&&(window.addEventListener?window.addEventListener("message",mp_bridge_listener):window.attachEvent("onmessage",mp_bridge_listener),window.MpBridgeListenerAttached=!0),t.exports={Bridge:r,callAction:function(e,t,i){i.postMessage({name:e,data:t,bridgeAction:!0},"*")}}},{}],4:[function(e,t,i){"use strict";t.exports=function(e,t){e.innerHTML="",e.innerHTML='<div id="marketWidget_'+e.id+'"></div>',e.dataset.clid=t;var i=document.createElement("script");i.src="https://aflt.market.yandex.ru/widget/script/api",i.type="text/javascript",document.body.appendChild(i),i.onload=function(){this.id,t=this.dataset.clid;var e=function(){window.removeEventListener("YaMarketAffiliateLoad",e),YaMarketAffiliate.createWidget({containerId:"marketWidget_"+this.id,type:"offers",params:{clid:t,searchText:"Смартфон",themeId:2}})}.bind(this);window.YaMarketAffiliate?e():window.addEventListener("YaMarketAffiliateLoad",e)}.bind(e)}},{}],5:[function(e,t,i){"use strict";window.WidgetEditor=e("./../models/WidgetEditor")},{"./../models/WidgetEditor":1}]},{},[5]);